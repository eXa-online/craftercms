#!/usr/bin/env bash

set -euECo pipefail

declare -r CRAFTER_JRE=docker-harbor1.support.ecom.thalia.de/cms/crafter-jre

# build the crafter-jre image if needed
if ! docker inspect -f '{{.Id}}' "$CRAFTER_JRE" &> /dev/null; then
    docker build --pull -t "$CRAFTER_JRE" docker/jre
fi

declare -r CRAFTER_ENV="$1"

cp -f docker/$CRAFTER_ENV/Dockerfile docker/$CRAFTER_ENV/supervisor.conf crafter-$CRAFTER_ENV/
cp -f docker/docker-crafter crafter-$CRAFTER_ENV/bin/
